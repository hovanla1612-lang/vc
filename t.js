(async()=>{const e=[{p:0x4ad4eaf449000,c:"CRMNUICLHCMT1",s:"c847bfced76531f9f5ad608e27756b312e3a31d4769fe9e07135f07f1902b276"},{p:0x4ad4eaec89000,c:"CRMNUICLSOUTHT1",s:"14bac24168c50efa23b84f0c40d2a5002855b3e66be9f6405977d2898006973f"},{p:0x4acdea2d09000,c:"CRMNUIIZCL200T1",s:"9de43b38587fb20bc741279dcf4cf402f3051a66e4f8cf956e63b93d07f2181c"},{p:0x4af515742900c,c:"FSV-1318663798034444",s:"01e2c5335846eac749fd386d1a623c3c14df6ebff39f7a774bbd14ab217bc058"},{p:0x4af51575e9008,c:"FSV-1318663799869448",s:"09afc76b4cd09799d65e859a8213f4a52295f16195573c3475cedba793fd0556"},{p:0x4af5156cc900c,c:"FSV-1318663790301196",s:"24f08e3c4092a2099046dee40cb09cfa002b93a7d9c84ccde234e514f806dbfd"}];document.body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#fff;font-family:sans-serif"><div id="qi"></div><p id="qs" style="font-size:32px;font-weight:bold;margin:20px">‚è≥</p></div>';const t=e=>document.getElementById(e),a=localStorage;try{let o=a.getItem("qrcode_id"),n=a.getItem("qrcode_time");if(o&&n&&Date.now()-parseInt(n)<12e4){let n;t("qs").textContent="üì± ƒêang ch·ªù qu√©t QR...";for(let e=0;e<60&&!n;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(o))).json();if(e.data&&"CONFIRMED"===e.data.status){n=e.data.qrcode_token;break}if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="‚è∞ H·∫øt h·∫°n",void a.clear()}if(!n)return t("qs").textContent="‚è∞ Timeout",void a.clear();t("qs").textContent="üîê Login...",await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({qrcode_token:n})}),t("qs").textContent="üé´ Saving...";let i=0;for(let t=0;t<e.length;t++){const a=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:a.p,voucher_code:a.c,signature:a.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&i++}return t("qs").textContent="‚úÖ "+i+"/"+e.length+" voucher ƒë√£ l∆∞u!",void a.clear()}a.clear();const i=await(await fetch("/api/v2/authentication/gen_qrcode")).json();let c;a.setItem("qrcode_id",i.data.qrcode_id),a.setItem("qrcode_time",Date.now().toString()),t("qi").innerHTML='<img src="data:image/png;base64,'+i.data.qrcode_base64+'" style="width:90vw;height:90vw;max-width:500px;max-height:500px">',t("qs").textContent="üì± Qu√©t QR";for(let e=0;e<60&&!c;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(i.data.qrcode_id))).json();if(e.data&&"CONFIRMED"===e.data.status)c=e.data.qrcode_token;else if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="‚è∞ H·∫øt h·∫°n",void a.clear()}if(!c)return t("qs").textContent="‚è∞ Timeout",void a.clear();t("qs").textContent="üîê Login...",await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({qrcode_token:c})}),t("qs").textContent="üé´ Saving...";let d=0;for(let t=0;t<e.length;t++){const a=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:a.p,voucher_code:a.c,signature:a.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&d++}t("qs").textContent="‚úÖ "+d+"/"+e.length+" voucher ƒë√£ l∆∞u!",a.clear()}catch(e){t("qs").textContent="‚ùå "+e}})();
