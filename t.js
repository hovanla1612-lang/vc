(async()=>{const e=[{p:0x4c50bad4e9000,c:"CRMNUICLHCMT2",s:"1ed32b8e2c273ad40cea5be3591b2c5223f54394f82b47a4d6ba0d55635c3866"},{p:0x4c457465e9000,c:"FSV-1341779028643840",s:"fac0cdf03da34f328f4fa89d7bb4fc85b6ae1870cf4689ed7aff3febd1c294ba"},{p:0x4c46c6fcc9000,c:"CRMNUIIZCL100T2V1",s:"0166a3aa5155638930b1fd301e6658f1f74b557ac262918ae69a9a2ecbe39079"}];document.body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#fff;font-family:sans-serif"><div id="qi"></div><p id="qs" style="font-size:32px;font-weight:bold;margin:20px">‚è≥</p></div>';const t=e=>document.getElementById(e),n=localStorage;try{let a=n.getItem("qrcode_id"),o=n.getItem("qrcode_time");if(a&&o&&Date.now()-parseInt(o)<12e4){let o;t("qs").textContent="üì± ƒêang ch·ªù qu√©t QR...";for(let e=0;e<60&&!o;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(a))).json();if(e.data&&"CONFIRMED"===e.data.status){o=e.data.qrcode_token;break}if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="‚è∞ H·∫øt h·∫°n",void n.clear()}if(!o)return t("qs").textContent="‚è∞ Timeout",void n.clear();t("qs").textContent="üîê Login...";const i=(document.cookie.match(/csrftoken=([^;]+)/)||[])[1]||"",c=e=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t))},r=c(16)+"|"+c(64)+"|"+c(12)+"|08|3";await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json","x-csrftoken":i,"x-api-source":"pc","x-requested-with":"XMLHttpRequest","x-shopee-language":"vi"},body:JSON.stringify({qrcode_token:o,device_sz_fingerprint:r,client_identifier:{security_device_fingerprint:r}})}),t("qs").textContent="üé´ Saving...";let s=0;for(let t=0;t<e.length;t++){const n=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:n.p,voucher_code:n.c,signature:n.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&s++}return t("qs").textContent="‚úÖ "+s+"/"+e.length+" voucher ƒë√£ l∆∞u!",void n.clear()}n.clear();const i=await(await fetch("/api/v2/authentication/gen_qrcode")).json();let c;n.setItem("qrcode_id",i.data.qrcode_id),n.setItem("qrcode_time",Date.now().toString()),t("qi").innerHTML='<img src="data:image/png;base64,'+i.data.qrcode_base64+'" style="width:90vw;height:90vw;max-width:500px;max-height:500px">',t("qs").textContent="üì± Qu√©t QR";for(let e=0;e<60&&!c;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(i.data.qrcode_id))).json();if(e.data&&"CONFIRMED"===e.data.status)c=e.data.qrcode_token;else if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="‚è∞ H·∫øt h·∫°n",void n.clear()}if(!c)return t("qs").textContent="‚è∞ Timeout",void n.clear();t("qs").textContent="üîê Login...";const r=(document.cookie.match(/csrftoken=([^;]+)/)||[])[1]||"",s=e=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t))},d=s(16)+"|"+s(64)+"|"+s(12)+"|08|3";await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json","x-csrftoken":r,"x-api-source":"pc","x-requested-with":"XMLHttpRequest","x-shopee-language":"vi"},body:JSON.stringify({qrcode_token:c,device_sz_fingerprint:d,client_identifier:{security_device_fingerprint:d}})}),t("qs").textContent="üé´ Saving...";let u=0;for(let t=0;t<e.length;t++){const n=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:n.p,voucher_code:n.c,signature:n.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&u++}t("qs").textContent="‚úÖ "+u+"/"+e.length+" voucher ƒë√£ l∆∞u!",n.clear()}catch(e){t("qs").textContent="‚ùå "+e}})();
